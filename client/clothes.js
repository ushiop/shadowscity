var Vehmenu=API.createMenu("變性",0,0,6);
var Clomenu=API.createMenu("換膚",0,0,6);
var newSkinID;
var oldSkinID; 
var but=null;
var cam=null;
var ped=null;
var skinlist=[
71929310,
1074457665,
-1988720319,
-257153498,
1413662315,
1430544400,
-1251702741,
1268862154,
-2132435154,
-781039234,
-67533719,
1841036427,
-680474188,
1567728751,
1644266841,
-252946718,
1830688247,
-1779492637,
-1643617475,
233415434,
1206185632,
-413773017,
117698822,
-815646164,
-1513650250,
-236444766,
-39239064,
-984709238,
-412008429,
-839953400,
-1782092083,
1669696074,
1657546978,
2129936603,
650367097,
-1306051250,
68070371,
-261389155,
939183526,
-1734476390,
1752208920,
-636391810,
-198252413,
588969535,
361513884,
-1492432238,
-1410400252,
599294057,
-1022961931,
-1868718465,
-1755309778,
-442429178,
797459875,
1767447799,
2014052797,
1380197501,
1250841910,
189425762,
808859815,
-945854168,
1077785853,
-2077764712,
-771835772,
2021631368,
600300561,
-408329255,
2114544056,
-900269486,
-994634286,
1464257942,
-1113448868,
-1267809450,
-1106743555,
1146800212,
1423699487,
1982350912,
-1606864033,
1546450936,
1068876755,
1720428295,
549978415,
920595805,
1984382277,
-96953009,
-1275859404,
2047212121,
1349953339,
-832573324,
848542878,
-933295480,
1004114196,
-1613485779,
-1111799518,
1915268960,
-270159898,
933205398,
1633872967,
-2101379423,
-1954728090,
-1931689897,
-654717625,
-1697435671,
664399832,
2120901815,
-912318012,
532905404,
826475330,
-1280051738,
-1366884940,
-1589423867,
-1211756494,
-1382092357,
-2063996617,
71501447,
1975732938,
327394568,
-1932625649,
-520477356,
-359228352,
1462895032,
-907676309,
261586155,
-2054645053,
-1369710022,
1240128502,
-1555576182,
788443093,
-166363761,
-1176698112,
-1430839454,
275618457,
2119136831,
-9308122,
-1469565163,
-1463670378,
610290475,
351016938,
1650288984,
-1057787465,
1825562762,
-607414220,
-1660909656,
-429715051,
-890640939,
436345731,
-1230338610,
-673538407,
-973145378,
368603149,
1581098148,
-1699520669,
1457690978,
773063444,
228356856,
-50684386,
1682622302,
678319271,
-1041006362,
402729631,
-1538297973,
755956971,
-37334073,
1182012905,
216536661,
365775923,
-2054740852,
-459818001,
-321892375,
-664053099,
-2113195075,
1870669624,
-1249041111,
1952555184,
788622594,
-1688898956,
-12678997,
1646160893,
349680864,
-2039072303,
-730659924, 
-1674727288,
1198698306,
579932932,
1699403886,
766375082,
-628553422,
1012965715,
-872673803,
-1549575121,
1943971979,
1976765073,
-175076858,
-1656894598,
-173013091,
-106498753,
-1538846349,
1674107025,
70821038,
131961260,
377976310,
1371553700,
712602007,
1755064960,
2010389054,
-1434255461,
1161072059,
-795819184,
1191403201,
1777626099,
1097048408,
-398748745,
866411749,
-613248456,
-2077218039,
1309468115,
-1806291497,
-88831029,
-1244692252,
1641152947,
951767867,
988062523,
1482427218,
373000027,
874722259,
-2051422616,
-306416314,
653289389,
1558115333,
2072724299,
728636342,
732742363,
1189322339,
-1229853272, 
1165780219,
331645324,
-1313761614,
103106535,
466359675,
-1692214353,
-1667301416,
1885233650,
-2078561997,
-1453933154,
-294281201,
1240094341,
-775102410,
-1519253631,
-1567723049,
115168927,
330231874,
793439294,
1640504453,
-1386944600,
-1736970383,
891398354,
411102470,
1169888870,
2111372120,
-1444213182,
-685776591,
-1001079621,
815693290,
-20018299,
2058033618,
-396800478,
261428209,
-961242577,
-1289578670,
-1022036185,
-1715797768,
1099825042, 
1704428387,
-325152996,
1809430156,
-512913663,
1794449327,
-245247470,
691061163,
813893651,
1358380044,
1822107721,
2064532783,
-264140789,
343259175,
2097407511,
-2109222095,
587703123,
-1745486195,
349505262,
-1514497514,
1312913862,
429425116,
42647445,
348382215,
51789996,
-1768198658,
1863555924, 
-837606178,
1531218220,
1318032802,
1939545845,
880829941,
-482210853,
-1160266880,
153984193,
-573920724,
706935758,
1153203121,
225287241,
808778210,
-1040164288,
-1452549652,
2050158196,
-835930287,
767028979,
-254493138,
257763003,
1145088004,
-1395868234,
-422822692,
-308279251,
60192701,
1459905209,
-1194552652,
-1105179493,
-258122199,
-2016771922,
-91572095,
-518348876,
1167549130,
2040438510,
1158606749,
-619494093,
-1849016788,
2109968527,
-346957479,
1269774364,
1530648845, 
891945583,
611648169,
-1880237687,
2093736314,
1388848350,
1204772502,
-782401935,
355916122,
452351020,
1090617681,
696250687,
1706635382,
1162230285,
-1635724594,
321657486,
-538688539,
949295643,
1302784073,
-1248528957,
1401530684,
1918178165,
-570394627,
666718676,
-610530921,
-44746786,
1330042375,
1032073858,
850468060,
1985653476,
-52653814,
1477887514,
-527186490,
803106487,
-927261102,
-46035440,
-72125238,
2124742566,
-220552467,
1702441027,
-265970301,
1490458366,
1925237458,
479578891,
411185872,
1464721716,
943915367,
1129928304,
-1552967674,
161007533,
1005070462,
-1127975477,
1631478380,
1768677545,
1466037421,
1226102803,
-578715987,
-1109568186,
653210662,
832784782,
-1773333796,
-1302522190,
810804565,
225514697,
-1080659212,
1890499016,
-715445259,
-317922106,
1191548746,
-886023758,
-1217776881,
1021093698,
1095737979,
1573528872,
-785842275,
-1358701087,
1167167044,
1694362237,
2007797722,
307287994,
1684083350,
1270514905,
-1922568579,
894928436,
587253782,
-664900312,
-407694286,
1822283721,
-304305299,
-1010001291,
946007720,
-872569905,
503621995,
1334976110,
1264920838,
-920443780,
-568861381,
1325314544,
-1124046095,
2023152276,
-927525251,
-515400693,
-287649847,
1746653202,
1906124788,
518814684,
-283816889,
-1728452752,
1625728984,
-1955548155,
768005095,
1641334641,
-1389097126,
648372919,
-1059388209,
-199280229,
357551935,
1528799427,
-322270187,
1346941736,
-1717894970,
1798879480,
-1286380898,
921110016,
-2114499097,
-982642292,
-544533759,
1209091352,
994527967,
193469166,
-1323586730,
111281960,
-413447396,
-1422914553,
-163714847,
-598109171,
1329576454,
-1561829034,
-1445349730,
-2088436577,
1125994524,
645279998,
1635617250,
602513566,
793443893,
1650036788,
1936142927,
1681385341,
1299047806,
-756833660,
1456041926,
1596003233,
2073775040,
-1313105063,
-2057423197,
-267695653,
-988619485,
379310561,
-1760377969,
-1576494617,
-829029621,
1888624839,
2141384740,
666086773,
512955554,
1832265812,
-541762431,
-449965460,
-1031795266,
1165307954,
-2054384456,
-554721426,
569740212,
1634506681,
-424905564,
-162605104,
-1614285257,
-277793362,
940326374,
411081129,
-1011537562,
776079908,
882848737,
-1026527405,
1624626906,
-178150202,
-1067576423,
-709209345,
-1436281204,
-1788665315,
1011059922,
-951490775,
623927022,
-2076336881,
1064866854,
1001210244,
1024089777,
1179785778,
-569505431,
-855671414,
1328415626,
539004493,
-681546704,
1626646295,
-1299428795,
-1773858377,
-1872961334,
663522487,
846439045,
62440720,
1794381917,
-614546432,
1092080539,
-1689993,
-1948177172,
-1420211530,
-745300483,
-681004504,
1126154828,
1096929346,
-1320879687,
-1371020112,
416176080,
-1452399100,
1846684678,
1055701597,
1283141381,
-1064078846,
1767892582,
-640198516,
-1044093321,
-1342520604,
-1332260293,
32417469,
451459928,
193817059,
-2034368986,
-154017714,
1951946145,
1039800368,
744758650,
1750583735,
718836251,
-417940021,
-215821512,
-1519524074,
1519319503,
-1620232223,
1082572151,
-1398552374,
-2018356203,
-1948675910,
238213328,
-1007618204,
-1023672578,
-1976105999,
-840346158,
-1408326184,
1535236204,
-1852518909,
-812470807,
-1731772337,
941695432,
-1528782338, 
-2039163396,
-1029146878,
915948376,
-1992464379,
-1360365899,
1381498905,
-2126242959,
1846523796,
695248020,
1544875514,
2035992488,
469792763,
-48477765,
228715206,
-829353047,
-1837161693,
605602864,
919005580,
-1222037748,
-356333586,
-1920001264,
824925120,
-2063419726,
-409745176,
226559113,
1123963760,
-597926235,
-2006710211,
2089096292,
1397974313,
-1709285806,
-1800524916,
1426880966,
1416254276,
-1573167273,
1545995274,
1728056212,
978452933, 
1776856003,
-847807830,
-1945119518,
-892841148,
1665391897,
-1661836925,
1347814329,
1446741360,
-929103484,
-1859912896,
-566941131,
101298480,
1461287021,
-567724045,
1787764635,
1224306523,
516505552,
390939205,
-1935621530,
1404403376,
-521758348,
-150026812,
-1686040670,
1498487404,
1382414087,
-277325206,
-1614577886,
-792862442,
-905948951,
1520708641,
-995747907,
-100858228,
1224690857,
999748158,
-1047300121,
435429221,
1264851357,
-625565461,
1561705728,
933092024,
534725268,
-85696186,
835315305,
-1835459726,
-765011498,
-1387498932,
-1427838341,
819699067,
-1384627013,
-1871275377,
1426951581,
1142162924,
-1105135100,
-1004861906,
-1425378987,
188012277,
-357782800,
-1404353274]

 API.onResourceStart.connect(function(){
	 //new Vector3(-716.3962,-162.2415,36.19393),new Vector3(-0.02342723,0.355593,29.58234)//cam
//new Vector3(-719.264,-158.2872,36.19803),new Vector3(-0.1573869,-0.3500315,-149.8079)//ped
	//blip=API.createBlip(new Vector3(297.213,-583.9615,42.76713));
	//API.setBlipSprite(blip,51);
	//mark=API.createMarker(1,new Vector3(297.213,-583.9615,38.76713),new Vector3(),new Vector3(),new Vector3(5,5,10),0,64,128,32); 
	//lab= API.createTextLabel("按~g~G~w~打開變性菜單\n請不要將車開進來\n否則你會很尷尬...",new Vector3(297.213,-583.9615,44.76713),100,1,false); 
	resource.mainMenu.menuPool.Add(Vehmenu); 
	resource.mainMenu.menuPool.Add(Clomenu); 
	blip=API.createBlip(new Vector3(-718.7359,-158.2292,36.5685));
	API.setBlipSprite(blip,73);	
	mark=API.createMarker(1,new Vector3(-718.7359,-158.2292,32.5685),new Vector3(),new Vector3(),new Vector3(5,5,10),0,64,128,32); 
	lab= API.createTextLabel("按~g~G~w~打開換膚菜單\n請不要將車開進來\n否則你會很尷尬...",new Vector3(-718.7359,-158.2292,41.5685),100,1,false); 
	cam=API.createCamera(new Vector3(-716.3962,-162.2415,37.19393),new Vector3(-0.02342723,0.355593,35.58234));
	newSkinID=0;
	oldSkinID=0;
	Clomenu.OnMenuClose.connect(function(menu){
		//结束改装，恢复到旧样式
		show=false;
		API.triggerServerEvent("SC_clothes_changesex_freeze",false);
		newSkinID=oldSkinID;
		setClo(skinlist[newSkinID]);
		
				API.deleteEntity(ped);
				
							API.setActiveCamera(null);
		createCloMenu();
	})	
	createCloMenu();
	//createModMenu();
});
 

 function copy(list)
 {
	var obj=JSON.parse(JSON.stringify(list));
	return obj;
 }

 function AddColListItem(modName,modId,fid){
		 var list=new List(String);
//645需要屏蔽
			for(var z=0;z<skinlist.length;z++)
			{
				list.Add(z.toString());
			}
			var select=0;
			
			if(newSkinID!=0)
			{
				select=newSkinID;
			}else{
				select=0;
			} 
			 
			var modItem=API.createListItem(modName,"選擇數字進行預覽\n回車進行購買,立即生效",list,select);
			but=modItem;
			modItem.OnListChanged.connect(function(menu,item){
				//TRIGGER SERVER GOTO Function 
				//API.sendNotification("你選擇改裝了 ~g~"+modName+" ~w~ ID:"+modId+" "+item.Index);
				//setVehiclePrimaryColor 設置車輛顏色(用GTA-V內置顏色ID）
				//setVehicleSecondaryColor 設置車輛副色(同上)
				
				API.deleteEntity(ped);
				
				ped=API.createPed(skinlist[parseInt(menu.Index)],new Vector3(-720.2573,-158.6887,37.20495), 0);
				setClo(skinlist[menu.Index]);
				newSkinID=menu.Index;
 
			});	
			modItem.Activated.connect(function(menu,item){		
				oldSkinID=newSkinID;
				API.triggerServerEvent("SC_clothes_changeskin_skin",skinlist[newSkinID]);
			});
	
		return modItem;  
 }
 
 function setClo(id)
 {
	id=parseInt(id) 
	API.setPlayerSkin(id);
 }
 
 function createCloMenu()
  {
	Clomenu.Clear();
	Clomenu.AddItem(AddColListItem("皮膚",0,0));
	Clomenu.RefreshIndex();
  }  
  
 /* function createModMenu()
  {
	var nameItem=API.createMenuItem("變為男性","")
	Vehmenu.AddItem(nameItem);
	nameItem.Activated.connect(function(menu,item){
			//TRIGGER SERVER GOTO Function
			//API.triggerServerEvent("SC_Vehicle_CALL_VEH",vid);
			API.triggerServerEvent("SC_clothes_changesex_sex","男"); 
		});		 
	nameItem=API.createMenuItem("變為女性","")
	
	Vehmenu.AddItem(nameItem);
	nameItem.Activated.connect(function(menu,item){
			//TRIGGER SERVER GOTO Function
			//API.triggerServerEvent("SC_Vehicle_CALL_VEH",vid);
			
			API.triggerServerEvent("SC_clothes_changesex_sex","女");  
		});	
	Vehmenu.RefreshIndex();
  }
 */
 
  
 API.onServerEventTrigger.connect(function (eventName, args) {
 
	if(eventName=="SC_clothes_skinid"){ 
		var js=parseInt(args[0]); 
		for(var i=0;i<skinlist.length;i++)
		{
			
			if(skinlist[i]==js)
			{ 
				newSkinID=i;
				oldSkinID=i;
				 
				break;
			}
		}
		createCloMenu();
	}
})

 
 API.onKeyDown.connect(function(sender, keyEventArgs) {

		if (keyEventArgs.KeyCode == Keys.G) {
				if(API.getEntitySyncedData(API.getLocalPlayer(), "SC_Login_Status")==1){
			/*if(API.isPlayerInAnyVehicle(API.getLocalPlayer())==false){
				
				var p=API.getEntityPosition(API.getLocalPlayer());  
				if(API.isInRangeOf(API.getEntityPosition(API.getLocalPlayer()),new Vector3(297.213,-583.9615,42.76713),3))
				{
			//-378.43505859375,-120.35971069335938,38.01585388183594 
					//new Vector3(-718.7359,-158.2292,36.5685)
						if(resource.menuOpen.MenuOpen()==true){  
							Vehmenu.Visible =true;
								//开始改装，冻结
							//API.triggerServerEvent("SC_vehicle_changemod_freeze",true);	
							API.triggerServerEvent("SC_clothes_changesex_freeze",true);							
							if(API.getEntitySyncedData(API.getLocalPlayer(),"SC_SEX_CHANGE")==1){
								API.setMenuSubtitle(Vehmenu,"本次變性花費:~y~免費"); 
							}else{
								API.setMenuSubtitle(Vehmenu,"本次變性花費:~y~$100000"); 
							}
						}
	
				} 
			}*/if(API.isInRangeOf(API.getEntityPosition(API.getLocalPlayer()),new Vector3(-718.7359,-158.2292,36.5685),3))
				{
					if(API.isPlayerInAnyVehicle(API.getLocalPlayer())==false){
				 
				
			//-378.43505859375,-120.35971069335938,38.01585388183594 
					//new Vector3(-718.7359,-158.2292,36.5685)
 
						if(resource.menuOpen.MenuOpen()==true){  
							Clomenu.Visible =true;
							show=true
								//开始改装，冻结
							//API.triggerServerEvent("SC_vehicle_changemod_freeze",true);	
							API.setEntityPosition(API.getLocalPlayer(),new Vector3(-719.264,-158.2872,36.19803));
							API.setEntityRotation(API.getLocalPlayer(),new Vector3(-0.1573869,-0.3500315,-149.8079));
							API.triggerServerEvent("SC_clothes_changesex_freeze",true);							
							oldSkinID=newSkinID;
							ped=API.createPed(skinlist[newSkinID],new Vector3(-720.2573,-158.6887,37.20495), 0);
							if(API.getEntitySyncedData(API.getLocalPlayer(),"SC_SKIN_CHANGE")==1){
								API.setMenuSubtitle(Clomenu,"本次換膚花費:~y~免費"); 
							}else{
								API.setMenuSubtitle(Clomenu,"本次換膚花費:~y~$10000"); 
							}
							API.setActiveCamera(cam);
						}
			 
				} 
			}			
		}
	}
});
var show=false
API.onUpdate.connect(function(){ 
	if(show==true)
	{  
		var money=0;
		API.setMenuSubtitle(Clomenu,"本次換膚花費:~y~免費"); 
		if(API.getEntitySyncedData(API.getLocalPlayer(),"SC_SKIN_CHANGE")!=1)
		{
			money=10000;
			API.setMenuSubtitle(Clomenu,"本次換膚花費:~y~$10000"); 
		}
		if(API.getEntitySyncedData(API.getLocalPlayer(),"SC_money")>=money)
		{
			but.Enabled=true; 
		}else{
			but.Enabled=false; 
		} 
	}
})